# Change these paths
output_dir = '/workspace/outputs'
dataset = '/workspace/examples/dataset_lineart.toml'

# training settings
epochs = 1000
micro_batch_size_per_gpu = 1
pipeline_stages = 1
gradient_accumulation_steps = 4
gradient_clipping = 1
#warmup_steps = 100

# eval settings
eval_every_n_epochs = 1
#eval_every_n_steps = 100
eval_before_first_step = true
eval_micro_batch_size_per_gpu = 1
eval_gradient_accumulation_steps = 1

# misc settings
save_every_n_epochs = 5
#save_every_n_steps = 500
#checkpoint_every_n_epochs = 1
checkpoint_every_n_minutes = 120
activation_checkpointing = true
partition_method = 'parameters'
save_dtype = 'bfloat16'
caching_batch_size = 8
steps_per_print = 1
blocks_to_swap = 8

[model]
type = 'qwen_image'
transformer_path = '/workspace/comfy/models/diffusion_models/qwen_image_distill_full_bf16.safetensors'
text_encoder_path = '/workspace/comfy/models/text_encoders/qwen_2.5_vl_7b.safetensors'
vae_path = '/workspace/comfy/models/vae/diffusion_pytorch_model.safetensors'
dtype = 'bfloat16'
transformer_dtype = 'float8'
timestep_sample_method = 'logit_normal'

[adapter]
type = 'lora'
rank = 32
dtype = 'bfloat16'

# Automagic should work fine and requires no tuning, but you can probably get better results using AdamW
# with a properly tuned learning rate.
[optimizer]
type = 'automagic'
weight_decay = 0.01

# [optimizer]
# type = 'AdamW8bitKahan'
# lr = 2e-5
# betas = [0.9, 0.99]
# weight_decay = 0.01
